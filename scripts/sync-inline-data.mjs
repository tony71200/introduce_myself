import { readFile, writeFile } from "fs/promises";
import { resolve } from "path";

const root = process.cwd();
const dataPath = resolve(root, "data.xml");
const targetPath = resolve(root, "assets/js/site-data-inline.js");

const xml = await readFile(dataPath, "utf8");
const escaped = xml.replace(/`/g, "\\`");
const banner = "// Auto-generated by scripts/sync-inline-data.mjs\n" +
  "// Do not edit this file directly; update data.xml and run the sync script.\n\n";
const content = `${banner}window.__SITE_DATA_XML__ = String.raw\`\n${escaped}\`\n  .trim();\n`;

await writeFile(targetPath, content, "utf8");
